
    <%- include ('partials/header') -%>
    
    <main>
        <div id="messageDiv" class="flex flex-col items-center w-full max-page-width mx-auto">
            <!-- Message Div -->
            <div id="message" class="w-full hidden absolute z-50 max-page-width text-center bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded  mt-20 md:mt-24"></div>

            <div id="messageError" class="w-full hidden absolute z-50 max-page-width text-center bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded  mt-20 md:mt-24"></div>
        </div>

        <section class="md:h-full relative flex flex-col justify-center items-center max-h-full lg:max-h-[850px]" id="landingPage">
            <div class="flex flex-col md:flex-row md:justify-between max-page-width px-4 sm:px-12 md:px-16 lg:px-28">
                <div class="w-[100%] md:w-[55%] mt-28 sm:mt-36 md:mb-24 lg:mb-24">
                    <h1 class="text-5xl sm:text-5xl md:text-5xl lg:text-7xl xl:text-7xl font-medium">Your Dream <br class="hidden lg:block"> <span class="text-[#10B981]">Job Is Waiting</span></h1>
                    <p class="text-4xl lg:text-6xl mt-4">5000+ Jobs</p>
    
                    <form action="/find-job" method="post" class="flex flex-col sm:flex-row gap-y-2">
                        <div class="w-[100%] flex flex-row items-center justify-between border-[#10B981] border-2 rounded-3xl pl-4 mt-8 md:mt-12">
                            <label for="searchTitle">
                                <img src="/public/images/search-icon.png" alt="">
                            </label>
                            <input class="w-[50%] pl-2 me-2 outline-none bg-transparent" type="text" id="searchTitle" name="searchTitle" placeholder="Enter job title" required>
        
                            <span class="h-14 w-[2px] bg-[#10B981] mr-2"></span>
        
                            <label for="searchLocation">
                                <img src="/public/images/location-icon.png" alt="">
                            </label>
                            <input class="w-[50%] pl-2 me-2 outline-none bg-transparent" type="text" id="searchLocation" name="searchLocation" placeholder="Enter Location">
        
                            <button class="hidden sm:block text-lg font-medium rounded-xl sm:rounded-3xl bg-[#10B981] text-white h-14 sm:px-6 border-2" type="submit">Search</button>
                            
                        </div>

                        <button class="block sm:hidden text-lg font-medium rounded-xl bg-[#10B981] text-white h-14 px-4 md:px-6" type="submit">Search</button>                       
                    </form>
                </div>

                <div class="flex justify-center w-[100%] md:w-[35%] lg:w-[40%] mt-8 md:mt-28 md:mb-20 lg:mb-20">
                    <img src="/public/images/image 1.png" alt="hero image">
                </div>
            </div>           
        </section>
        
        <section class="sm:pb-16 lg:pb-11 colored-section  flex flex-col items-center max-h-full " id="categories">
            <div class=" max-page-width flex flex-col justify-between w-full h-full  relative">
                <div class="flex flex-row justify-between px-4 sm:px-12 lg:px-28 py-6 sm:p-10 w-full">
                    <h2 class="text-lg md:text-2xl font-semibold">Explore by <span class="text-[#10B981]">categories</span></h2>
                    <a href="find-job">
                        <h3 class="text-sm md:text-base flex flex-row items-center gap-2 font-semibold">Show all jobs <span><img src="/public/images/Arrow.png" alt="right arraow icon"></span></h3>
                    </a>
                </div>
    
                <div class="flex flex-wrap max-w-full justify-between md:justify-start pb-10 mx-4 sm:mx-12 lg:mx-36 gap-7 sm:gap-7 lg:gap-6">
                    <div class="category-card cursor-pointer bg-white px-4 py-4 md:px-6 md:py-6 rounded-lg w-[calc(50%-20px)] md:w-[calc(33.33%-20px)] lg:w-[calc(25%-20px)]" data-category="design">
                        <img src="/public/images/design-icon.png" alt="">
                        <h3 class="my-2">Design</h3>
                        <div class="flex flex-row items-center justify-between">
                            <p>25+ jobs available</p>
                            <img src="/public/images/Arrow.png" alt="right arraow icon">
                        </div>                   
                    </div>
                    <div class="category-card cursor-pointer bg-white px-4 py-4 md:px-6 md:py-6 rounded-lg w-[calc(50%-20px)] md:w-[calc(33.33%-20px)] lg:w-[calc(25%-20px)]" data-category="sales">
                        <img src="/public/images/sales.png" alt="">
                        <h3 class="my-2">Sales</h3>
                        <div class="flex flex-row items-center justify-between">
                            <p>25+ jobs available</p>
                            <img src="/public/images/Arrow.png" alt="right arraow icon">
                        </div>                   
                    </div>
                    <div class="category-card cursor-pointer bg-white px-4 py-4 md:px-6 md:py-6 rounded-lg w-[calc(50%-20px)] md:w-[calc(33.33%-20px)] lg:w-[calc(25%-20px)]" data-category="marketing">
                        <img src="/public/images/marketing.png" alt="">
                        <h3 class="my-2">Marketing</h3>
                        <div class="flex flex-row items-center justify-between">
                            <p>25+ jobs available</p>
                            <img src="/public/images/Arrow.png" alt="right arraow icon">
                        </div>                   
                    </div>
                    <div class="category-card cursor-pointer bg-white px-4 py-4 md:px-6 md:py-6 rounded-lg w-[calc(50%-20px)] md:w-[calc(33.33%-20px)] lg:w-[calc(25%-20px)]" data-category="finance">
                        <img src="/public/images/finance.png" alt="">
                        <h3 class="my-2">Finance</h3>
                        <div class="flex flex-row items-center justify-between">
                            <p>25+ jobs available</p>
                            <img src="/public/images/Arrow.png" alt="right arraow icon">
                        </div>                   
                    </div>
    
                    <div class="category-card cursor-pointer bg-white px-4 py-4 md:px-6 md:py-6 rounded-lg w-[calc(50%-20px)] md:w-[calc(33.33%-20px)] lg:w-[calc(25%-20px)]" data-category="technology">
                        <img src="/public/images/technology.png" alt="">
                        <h3 class="my-2">Technology</h3>
                        <div class="flex flex-row items-center justify-between">
                            <p>25+ jobs available</p>
                            <img src="/public/images/Arrow.png" alt="right arraow icon">
                        </div>                   
                    </div>
                    <div class="category-card cursor-pointer bg-white px-4 py-4 md:px-6 md:py-6 rounded-lg w-[calc(50%-20px)] md:w-[calc(33.33%-20px)] lg:w-[calc(25%-20px)]" data-category="engineering">
                        <img src="/public/images/engineering.png" alt="">
                        <h3 class="my-2">Engineering</h3>
                        <div class="flex flex-row items-center justify-between">
                            <p>25+ jobs available</p>
                            <img src="/public/images/Arrow.png" alt="right arraow icon">
                        </div>                   
                    </div>
                    <div class="category-card cursor-pointer bg-white px-4 py-4 md:px-6 md:py-6 rounded-lg w-[calc(50%-20px)] md:w-[calc(33.33%-20px)] lg:w-[calc(25%-20px)]" data-category="business">
                        <img src="/public/images/business.png" alt="">
                        <h3 class="my-2">Business</h3>
                        <div class="flex flex-row items-center justify-between">
                            <p>25+ jobs available</p>
                            <img src="/public/images/Arrow.png" alt="right arraow icon">
                        </div>                   
                    </div>
                    <div class="category-card cursor-pointer bg-white px-4 py-4 md:px-6 md:py-6 rounded-lg w-[calc(50%-20px)] md:w-[calc(33.33%-20px)] lg:w-[calc(25%-20px)]" data-category="humanResource">
                        <img src="/public/images/human-resources.png" alt="">
                        <h3 class="my-2">Human Resource</h3>
                        <div class="flex flex-row items-center justify-between">
                            <p>25+ jobs available</p>
                            <img src="/public/images/Arrow.png" alt="right arraow icon">
                        </div>                   
                    </div>
                </div>
    
                <div class=" flex items-center justify-between ">
                    <div class="bg-white md:rounded-lg md:mx-16 lg:mx-36 px-4 md:px-10 lg:px-20 flex flex-col gap-4 sm:flex-row sm:items-center justify-between w-full py-4">
                        <h1 class="text-xl sm:text-2xl md:text-4xl font-semibold">Get <span class="text-[#10B981]">Job Alert?</span></h1>

                        <form action="/subscribe" method="post" id="subscribeForm" class=" flex flex-row border-[#10B981] border-2 rounded-3xl items-center justify-between pl-4">   
                            <input class="outline-none bg-transparent" type="email" name="email" placeholder="Enter your email" required>
        
                            <div>                          
                                <button id="subscribeFormBtn" class="rounded-3xl bg-[#10B981] text-white h-11 sm:h-14 px-6 border-2" type="submit">
                                    Subscribe                                    
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            
        </section>

        <section class="bg-[#D9D9D9]  pb-14 flex flex-col items-center" id="featured-jobs">
            <div class=" max-page-width flex flex-col justify-between w-full relative gap-10">
                <div class="flex flex-row justify-between px-10 sm:px-12 lg:px-28 pt-10 w-full">
                    <h2 class="text-2xl font-semibold">Featured <span class="text-[#10B981]">Jobs</span></h2>
                    <a href="find-job">
                        <h3 class="flex flex-row items-center gap-2 font-semibold">Show all jobs <span><img src="/public/images/Arrow.png" alt="right arraow icon"></span>
                        </h3>
                    </a>
                </div>                            
    
                <div class="flex max-w-full place-content-start flex-wrap mx-10 md:mx-12 lg:mx-28 gap-6 md:gap-8 lg:gap-6 xl:gap-7" >
                    <% if (allJobs) { %>
                        <% allJobs.forEach(job => { %>
                            <div class="categories-box bg-white px-2 xl:px-6  py-3 rounded-lg w-full sm:w-[calc(50%-15px)] md:w-[calc(50%-20px)] lg:w-[calc(33.33%-20px)] flex flex-col">
                                <a href="/job-info/<%= job._id %>" style="display: block; width: 100%;">
                                    <div class="flex flex-col justify-between gap-y-8 h-full">
                                        <div class="flex flex-col gap-6">
                                            <div class="flex flex-row gap-4 ">
                                                <div class="w-12 h-12">
                                                    <img src="/public/images/Ellipse.png" alt="">
                                                </div>
                                                
                                                <div class="capitalize">
                                                    <h3 class="font-normal text-lg"><%= job.companyName %></h3>
                                                    <h4><%= job.companyLocation %></h4>
                                                </div>
                                            </div>
                                            
                                            <div class="flex flex-col gap-y-3 px-3 ">
                                                <h3 class="font-normal capitalize text-2xl"><%= job.jobTitle %></h3>
                                                <h4 class="capitalize"><%= job.jobType %></h4>
                                                <p class="text-[#585858]">
                                                    <%= job.jobDescription %></h4>
                                                </p>
                                            </div>
                                        </div>
                                        
                                        
                                        <div class="flex flex-row items-center justify-between px-3 ">
                                            <h3 class="text-base">$<%= job.salary %></h4></h3>
                                            <a href="/job-application?id=<%= job._id %>">
                                                <h3 class="text-[#10B981] hover:text-white hover:bg-[#10B981] hover:px-2 hover:rounded-md text-xl whitespace-nowrap">Apply Now</h3>
                                            </a>
                                        </div>                   
                                    </div>
                                </a>
                            </div>
                        <% }); %>
                    <% } %>
                    
                </div>
            </div>
            <div class="pb-24"></div>
        </section>

        
    </main>
    
    <script>
        document.querySelectorAll('.category-card').forEach(card => {
            card.addEventListener('click', function() {
                const category = this.getAttribute('data-category');
                console.log('category:', category);
                const url = new URL('/find-job', window.location.origin);
                console.log('url:', url);
                url.searchParams.append('category', category);
                window.location.href = url;
            });
        });

        document.getElementById('subscribeForm').addEventListener('submit', async function(event){
            event.preventDefault();

            const form = event.target;
            const formData = new FormData(form);
            const jsonData = Object.fromEntries(formData.entries());
            // console.log('jsondata:', jsonData);

            // document.getElementById('subscribeFormBtn').classList.add('animate-spin')
            const subscribeFormBtn = document.getElementById('subscribeFormBtn');
            const subscribeSuccessMessage = document.getElementById('message');
            const subscribeErrorMessage = document.getElementById('messageError')
            subscribeFormBtn.innerHTML = `
                                    <div class="flex gap-2">
                                        <svg class="animate-spin h-5 w-5 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A8.004 8.004 0 014.01 4.01h-.011M20 12c0-4.418-3.582-8-8-8v4c2.764 0 5.1 1.432 6.491 3.603M4.01 19.99A8.004 8.004 0 0112.001 20v4c4.418 0 8-3.582 8-8h-4z"></path>
                                        </svg> 

                                         <p> Subscribing...</p> 
                                    </div>`
            try {
                const response = await fetch('/subscribe', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(jsonData),
                });

                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }

                const result = await response.json();
                // console.log(result);               
                subscribeSuccessMessage.innerText = result.message;

                subscribeSuccessMessage.classList.remove('hidden')
                setTimeout(() => {
                    subscribeSuccessMessage.classList.add('hidden');
                }, 5000);
                
                subscribeFormBtn.innerHTML = '<p>Subscribe</p>'
            } catch (error) {
                console.error('Error:', error);
                subscribeErrorMessage.innerText = 'Subscription failed. Please try again.';
                subscribeErrorMessage.classList.remove('hidden')
                setTimeout(() => {
                    subscribeErrorMessage.classList.add('hidden');
                }, 5000);
            }

            document.getElementById('messageDiv').scrollIntoView({ behavior: 'smooth' });

        });

    </script>
</body>
</html>